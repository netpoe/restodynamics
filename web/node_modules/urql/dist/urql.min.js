"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var r=require("wonka"),t=require("graphql"),n=e(require("fast-json-stable-stringify")),o=e(require("graphql-tag")),i=require("react");function a(){return(a=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}).apply(this,arguments)}var u=function(e,r){var t="";return void 0!==e?t="[Network] "+e.message:(void 0!==r&&r.forEach(function(e){t+="[GraphQL] "+e.message+"\n"}),t.trim())},c=function(e){return"string"==typeof e?new t.GraphQLError(e):"object"==typeof e&&e.message?new t.GraphQLError(e.message,e.nodes,e.source,e.positions,e.path,e.originalError,e.extensions||{}):e};function s(){return this.message}var p=function(e){function r(r){var t=r.networkError,n=r.response,o=(r.graphQLErrors||[]).map(c),i=u(t,o);e.call(this,i),this.name="CombinedError",this.message=i,this.graphQLErrors=o,this.networkError=t,this.response=n}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.toString=s,r}(Error),f=function(e){for(var r=5381,t=0,n=0|e.length;t<n;t++)r=(r<<5)+r+e.charCodeAt(t);return r>>>0},d=Object.create(null);function v(e,r){return e+(void 0!==r.name?r.name.value:"")}var l=function(e,r){var o=function(e){if(void 0!==e.__key)return e.__key;var r=e.definitions.reduce(v,"");if("production"!==process.env.NODE_ENV&&""!==r){var n=t.print(e);r in d?d[r]!==n&&console.warn("Warning: Encountered multiple DocumentNodes with the same name."):d[r]=n}""===r&&(r=t.print(e));var o=f(r);return e.__key=o,o}(e);return null==r?o:f(""+o+n(r))},h=function(e,r){var t="string"==typeof e?o([e]):e;return{key:l(t,r),query:t,variables:r||{}}},y=function(e,r){return a({},e,{context:a({},e.context,{meta:a({},e.context.meta,r)})})},x=function(e,r){if(void 0===r&&(r=[]),Array.isArray(e))e.forEach(function(e){return x(e,r)});else if("object"==typeof e&&null!==e)for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t)){var n=e[t];"__typename"===t&&"string"==typeof n?r.push(n):"object"==typeof n&&null!==n&&x(n,r)}return r};function m(e,r,t){return t.indexOf(e)===r}var g=function(e){return x(e).filter(m)};function b(e){return"Field"===e.kind&&"__typename"===e.name.value}var O=function(e){return void 0!==e.selectionSet&&(e.selectionSet.selections.some(b)?e:a({},e,{selectionSet:a({},e.selectionSet,{selections:e.selectionSet.selections.concat([{kind:"Field",name:{kind:"Name",value:"__typename"}}])})}))},w=function(e){return t.visit(e,{Field:O,InlineFragment:O,OperationDefinition:O})},E=function(){},k=function(e){var r=e.operationName;return"subscription"!==r&&"query"!==r};function q(e){return""+e}var _=function(e){var r=e.error,t={data:e.data,error:void 0};return void 0!==r&&(t.error={networkError:""+r.networkError,graphQLErrors:r.graphQLErrors.map(q)}),t},S=function(e,r){var t=r.error,n={operation:e,data:r.data,extensions:void 0,error:void 0};return void 0!==t&&(n.error=new p({networkError:new Error(t.networkError),graphQLErrors:t.graphQLErrors})),n},N=function(e){var r=e.operationName;return"mutation"!==r&&"query"!==r};function C(e){return a({},e,{query:w(e.query)})}function R(e){return N(e)}function j(e){return y(e,{cacheOutcome:"miss"})}var P=function(e){var t=e.forward,n=e.client,o=new Map,i=Object.create(null),u=C,c=Q(o,i,n),s=D(o,i),p=function(e){var r=e.context.requestPolicy;return"query"===e.operationName&&"network-only"!==r&&("cache-only"===r||o.has(e.key))};function f(e){return!N(e)&&p(e)}function d(e){var r=e.context,t=o.get(e.key);return"cache-and-network"===r.requestPolicy&&M(n,e),void 0!==t?a({},t,{operation:y(t.operation,{cacheOutcome:"hit"})}):{data:void 0,error:void 0,extensions:void 0,operation:y(e,{cacheOutcome:"miss"})}}function v(e){return!N(e)&&!p(e)}function l(e){e.operation&&"mutation"===e.operation.operationName?c(e):e.operation&&"query"===e.operation.operationName&&s(e)}return function(e){var n=r.share(e),o=r.pipe(n,r.filter(f),r.map(d)),i=r.pipe(r.merge([r.pipe(n,r.filter(v),r.map(u)),r.pipe(n,r.filter(R))]),r.map(j),t,r.tap(l));return r.merge([o,i])}},M=function(e,r){return e.reexecuteOperation(a({},r,{context:a({},r.context,{requestPolicy:"network-only"})}))},Q=function(e,r,t){function n(r){if(e.has(r)){var n=e.get(r).operation;e.delete(r),M(t,n)}}return function(e){var t=new Set;function o(e){return t.add(e)}g(e.data).forEach(function(e){var t=r[e]||(r[e]=new Set);t.forEach(o),t.clear()}),t.forEach(n)}},D=function(e,r){return function(t){var n=t.operation,o=t.data;void 0!==o&&(e.set(n.key,{operation:n,data:o,error:t.error}),g(t.data).forEach(function(e){(r[e]||(r[e]=new Set)).add(n.key)}))}},L=function(e){return"subscription"===e.operationName};function A(e){return!L(e)}function U(e){return console.log("[Exchange debug]: Incoming operation: ",e)}function I(e){return console.log("[Exchange debug]: Completed operation: ",e)}var W=function(e){var t=e.forward,n=new Set,o=function(e){var r=e.key,t=e.operationName;if("teardown"===t)return n.delete(r),!0;if("query"!==t)return!0;var o=n.has(r);return n.add(r),!o},i=function(e){n.delete(e.operation.key)};return function(e){var n=r.pipe(e,r.filter(o));return r.pipe(t(n),r.tap(i))}};function F(e){var r=e.operationName;return"query"===r||"mutation"===r}var T=function(e){var t=e.forward,n=F;function o(e){return!n(e)}return function(e){var i=r.share(e),a=r.pipe(i,r.filter(n),r.mergeMap(function(e){var t=e.key,n=r.pipe(i,r.filter(function(e){return"teardown"===e.operationName&&e.key===t}));return r.pipe($(e),r.takeUntil(n))})),u=r.pipe(i,r.filter(o),t);return r.merge([a,u])}},$=function(e){if("subscription"===e.operationName)throw new Error("Received a subscription operation in the httpExchange. You are probably trying to create a subscription. Have you added a subscriptionExchange?");return r.make(function(r){var n=r[0],o=r[1],i="undefined"!=typeof AbortController?new AbortController:void 0,u=e.context,c="function"==typeof u.fetchOptions?u.fetchOptions():u.fetchOptions||{},s=a({body:JSON.stringify({query:t.print(e.query),variables:e.variables}),method:"POST"},c,{headers:a({"content-type":"application/json"},c.headers),signal:void 0!==i?i.signal:void 0}),p=Date.now();return G(e,s).then(function(e){void 0!==e&&n(a({},e,{operation:y(e.operation,{networkLatency:Date.now()-p})})),o()}),function(){void 0!==i&&i.abort()}})},G=function(e,r){var t,n=e.context;return(n.fetch||fetch)(n.url,r).then(function(e){return t=e,V(r.redirect,e),e.json()}).then(function(r){return{operation:e,data:r.data,error:Array.isArray(r.errors)?new p({graphQLErrors:r.errors,response:t}):void 0,extensions:"object"==typeof r.extensions&&null!==r.extensions?r.extensions:void 0}}).catch(function(r){if("AbortError"!==r.name)return{operation:e,data:void 0,error:new p({networkError:r,response:t}),extensions:void 0}})},V=function(e,r){if(void 0===e&&(e="follow"),r.status<200||r.status>=("manual"===e?400:300))throw new Error(r.statusText)};function Y(e){var r=e.operationName;"teardown"!==r&&"production"!==process.env.NODE_ENV&&console.warn('No exchange has handled operations of type "'+r+"\". Check whether you've added an exchange responsible for these operations.")}function B(){return!1}var H=function(e){return r.pipe(e,r.tap(Y),r.filter(B))},J=function(e){return 1===e.length?e[0]:function(r){var t=r.client;return e.reduceRight(function(e,r){return r({client:t,forward:e})},r.forward)}},z=[W,P,T],K=function(e){return new X(e)},X=function(e){var t=this;this.activeOperations=Object.create(null),this.createOperationContext=function(e){var r=(e||{}).requestPolicy;return void 0===r&&(r="cache-first"),a({url:t.url,fetchOptions:t.fetchOptions,fetch:t.fetch},e,{requestPolicy:r})},this.createRequestOperation=function(e,r,n){return{key:r.key,query:r.query,variables:r.variables,operationName:e,context:t.createOperationContext(n)}},this.reexecuteOperation=function(e){(t.activeOperations[e.key]||0)>0&&t.dispatchOperation(e)},this.executeQuery=function(e,r){var n=t.createRequestOperation("query",e,r);return t.executeRequestOperation(n)},this.executeSubscription=function(e,r){var n=t.createRequestOperation("subscription",e,r);return t.executeRequestOperation(n)},this.executeMutation=function(e,r){var n=t.createRequestOperation("mutation",e,r);return t.executeRequestOperation(n)},this.url=e.url,this.fetchOptions=e.fetchOptions,this.fetch=e.fetch,this.suspense=!!e.suspense;var n=r.makeSubject(),o=n[1];this.operations$=n[0];var i=[],u=!1;this.dispatchOperation=function(e){if(i.push(e),!u){var r;for(u=!0;void 0!==(r=i.shift());)o(r);u=!1}},this.exchange=J(void 0!==e.exchanges?e.exchanges:z),this.results$=r.share(this.exchange({client:this,forward:H})(this.operations$))};X.prototype.onOperationStart=function(e){var r=e.key;this.activeOperations[r]=(this.activeOperations[r]||0)+1,this.dispatchOperation(e)},X.prototype.onOperationEnd=function(e){var r=e.key,t=this.activeOperations[r]||0;(this.activeOperations[r]=t<=0?0:t-1)<=0&&this.dispatchOperation(a({},e,{operationName:"teardown"}))},X.prototype.executeRequestOperation=function(e){var t=this,n=e.key,o=e.operationName,i=r.pipe(this.results$,r.filter(function(e){return e.operation.key===n}));if("mutation"===o)return r.pipe(i,r.onStart(function(){return t.dispatchOperation(e)}),r.take(1));var a,u=r.pipe(i,r.onStart(function(){return t.onOperationStart(e)}),r.onEnd(function(){return t.onOperationEnd(e)}));return this.suspense?(a=u,r.make(function(e){var t,n,o=e[1],i=!1,u=r.pipe(a,r.onPush(e[0]),r.onEnd(o),r.subscribe(function(e){void 0===t?n=e:i||(t(e),o(),u())}))[0];if(void 0===n)throw new Promise(function(e){t=e});return function(){i=!0,u()}})):u};var Z=K({url:"/graphql"}),ee=i.createContext(Z),re=ee.Provider,te=ee.Consumer,ne="undefined"!=typeof window?i.useLayoutEffect:i.useEffect,oe=function(e){var r=i.useRef(!1),t=i.useState(e),n=t[0],o=t[1],u=i.useCallback(function(e){if(r.current)o(e);else{var t="function"==typeof e?e(n):e;a(n,t)}},[]);function c(){r.current=!1}return ne(function(){return r.current=!0,c},[]),[n,u]},ie=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ae=function(e){return e&&(0===e.tag||1===e.tag||2===e.tag)},ue=function(e){return"Query"===e.name||"Mutation"===e.name||"Subscription"===e.name};function ce(){var e="Component",r=ie.current;if(null!==r&&ae(r)){var t=r.type;ue(t)&&ae(r._debugOwner)&&(t=r._debugOwner.type),"function"==typeof t&&(e=t.displayName||t.name||e)}return{meta:{source:e}}}var se,pe="production"!==process.env.NODE_ENV&&ie?function(){return i.useMemo(ce,[])}:function(){},fe=function(e){var t=pe(),n=i.useContext(ee),o=oe({fetching:!1,error:void 0,data:void 0,extensions:void 0}),u=o[1];function c(e){return u({fetching:!1,data:e.data,error:e.error,extensions:e.extensions}),e}return[o[0],i.useCallback(function(o,i){u({fetching:!0,error:void 0,data:void 0,extensions:void 0});var s=h(e,o);return r.pipe(n.executeMutation(s,a({},t,i)),r.toPromise).then(c)},[n,t,e,u])]},de=function(e,r){var t=i.useRef(void 0);return i.useMemo(function(){var n=h(e,r);return void 0!==t.current&&t.current.key===n.key?t.current:(t.current=n,n)},[e,r])};function ve(e){return a({},e,{fetching:!0})}function le(e){return a({},e,{fetching:!1})}!function(e){e[e.WillMount=0]="WillMount",e[e.DidMount=1]="DidMount",e[e.Update=2]="Update"}(se||(se={}));var he=function(e){var t=pe(),n=i.useRef(E),o=i.useContext(ee),u=oe({fetching:!1,data:void 0,error:void 0,extensions:void 0}),c=u[0],s=u[1],p=de(e.query,e.variables);function f(e){s({fetching:!1,data:e.data,error:e.error,extensions:e.extensions})}var d=i.useCallback(function(i){var u;n.current(),s(ve),u=r.pipe(o.executeQuery(p,a({requestPolicy:e.requestPolicy},e.context,i,t)),r.subscribe(f)),n.current=u[0]},[e.context,e.requestPolicy,o,t,p,s]);function v(){return n.current()}return function(e,r){var t=i.useRef(void 0),n=i.useRef(se.WillMount);n.current===se.WillMount&&(n.current=se.DidMount,t.current=e()),i.useEffect(function(){return n.current===se.Update?t.current=e():(n.current=se.Update,t.current)},r)}(function(){return e.pause?(n.current(),s(le),E):(d(),v)},[d,e.pause,s]),[c,d]},ye=function(e,t){var n=pe(),o=i.useRef(E),u=i.useContext(ee),c=oe({fetching:!0,error:void 0,data:void 0,extensions:void 0}),s=c[0],p=c[1],f=de(e.query,e.variables);function d(e){var r=e.data,n=e.error,o=e.extensions;p(function(e){return{fetching:!0,data:void 0!==t?t(e.data,r):r,error:n,extensions:o}})}var v=i.useCallback(function(){var t;o.current(),t=r.pipe(u.executeSubscription(f,a({},n,e.context)),r.subscribe(d)),o.current=t[0]},[u,n,t,f,p,e.context]);function l(){return o.current()}return i.useEffect(function(){return v(),l},[v]),[s]};function xe(e,r){var t={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&r.indexOf(n)<0&&(t[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)r.indexOf(n[o])<0&&(t[n[o]]=e[n[o]])}return t}exports.Client=X,exports.CombinedError=p,exports.Consumer=te,exports.Context=ee,exports.Mutation=function(e){var r=e.children,t=fe(e.query);return r(a({},t[0],{executeMutation:t[1]}))},exports.Provider=re,exports.Query=function(e){var r=e.children,t=xe(e,["children"]),n=he(t);return r(a({},n[0],{executeQuery:n[1]}))},exports.Subscription=function(e){var r=e.children,t=e.handler,n=xe(e,["children","handler"]);return r(ye(n,t)[0])},exports.cacheExchange=P,exports.composeExchanges=J,exports.createClient=K,exports.createRequest=h,exports.debugExchange=function(e){var t=e.forward;return function(e){return r.pipe(e,r.tap(U),t,r.tap(I))}},exports.dedupExchange=W,exports.defaultExchanges=z,exports.fallbackExchangeIO=H,exports.fetchExchange=T,exports.formatDocument=w,exports.ssrExchange=function(e){var t={},n=function(e){return!k(e)&&void 0!==t[e.key]};function o(e){return!n(e)}function i(e){return n(e)}function u(e){return S(e,t[e.key])}function c(e){var r=e.operation;if(!k(r)){var n=_(e);t[r.key]=n}}function s(e){delete t[e.operation.key]}var p=function(t){var n=t.client,a=t.forward;return function(t){var p=e&&"boolean"==typeof e.isClient?!!e.isClient:!n.suspense,f=r.share(t),d=r.pipe(f,r.filter(o),a),v=r.pipe(f,r.filter(i),r.map(u));return p?v=r.pipe(v,r.tap(s)):d=r.pipe(d,r.tap(c)),r.merge([d,v])}};return p.restoreData=function(e){return a(t,e)},p.extractData=function(){return a({},t)},e&&e.initialState&&p.restoreData(e.initialState),p},exports.subscriptionExchange=function(e){var n=e.forwardSubscription;function o(e){var o=n({key:e.key.toString(36),query:t.print(e.query),variables:e.variables,context:a({},e.context)});return r.make(function(r){var t=r[0],n=o.subscribe({next:function(r){return t({operation:e,data:r.data||void 0,error:Array.isArray(r.errors)?new p({graphQLErrors:r.errors,response:void 0}):void 0,extensions:"object"==typeof r.extensions&&null!==r.extensions?r.extensions:void 0})},error:function(r){return t({operation:e,data:void 0,extensions:void 0,error:new p({networkError:r,response:void 0})})},complete:r[1]});return function(){return n.unsubscribe()}})}return function(e){var t=e.forward,n=o;return function(e){var o=r.share(e),i=r.pipe(o,r.filter(L),r.mergeMap(function(e){var t=e.key,i=r.pipe(o,r.filter(function(e){return"teardown"===e.operationName&&e.key===t}));return r.pipe(n(e),r.takeUntil(i))})),a=r.pipe(o,r.filter(A),t);return r.merge([i,a])}}},exports.useMutation=fe,exports.useQuery=he,exports.useSubscription=ye;
//# sourceMappingURL=urql.min.js.map
